{% if combined_jobs %}
    <div class="overflow-x-auto">
        <table class="table-sm table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>First Dataset</th>
                    <th>Second Dataset</th>
                    <th>Status</th>
                    <th>Nodes</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for job in combined_jobs %}
                    <tr>
                        <td>
                            <div class="text-xs">
                                {{ moment(job.started_at).format('YYYY-MM-DD HH:mm') if job.started_at else 'Unknown' }}
                            </div>
                        </td>
                        <td>
                            <div class="text-xs">
                                {{ job.first_job.uploaded_file.name }}
                                {% if job.first_job.uploaded_file.data_start_date and job.first_job.uploaded_file.data_end_date %}
                                    <br />
                                    <span class="text-base-content/60">
                                        {{ job.first_job.uploaded_file.data_start_date.strftime('%b %Y') }}
                                        -
                                        {{ job.first_job.uploaded_file.data_end_date.strftime('%b %Y') }}
                                    </span>
                                {% endif %}
                            </div>
                        </td>
                        <td>
                            <div class="text-xs">
                                {{ job.second_job.uploaded_file.name }}
                                {% if job.second_job.uploaded_file.data_start_date and job.second_job.uploaded_file.data_end_date %}
                                    <br />
                                    <span class="text-base-content/60">
                                        {{ job.second_job.uploaded_file.data_start_date.strftime('%b %Y') }}
                                        -
                                        {{ job.second_job.uploaded_file.data_end_date.strftime('%b %Y') }}
                                    </span>
                                {% endif %}
                            </div>
                        </td>
                        <td>
                            {% if job.status == "completed" %}
                                <span
                                    class="badge badge-success badge-sm badge-soft"
                                    >Completed</span
                                >
                            {% elif job.status == "processing" %}
                                <span
                                    class="badge badge-info badge-sm badge-soft"
                                    >Processing</span
                                >
                            {% elif job.status == "failed" %}
                                <span
                                    class="badge badge-error badge-sm badge-soft"
                                    >Failed</span
                                >
                            {% else %}
                                <span class="badge badge-sm badge-soft"
                                    >{{ job.status }}</span
                                >
                            {% endif %}
                        </td>
                        <td>
                            {% if job.total_nodes %}
                                <div class="text-xs">
                                    Total: {{ job.total_nodes }}<br />
                                    Old: {{ job.nodes_from_first }}<br />
                                    New: {{ job.new_nodes }}
                                </div>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if job.status == "completed" %}
                                <a
                                    href="{{ url_for('first.view_combined_graph', job_id=job.uuid) }}"
                                    hx-boost="true"
                                    hx-target="#content"
                                    hx-swap="show:window:top transition:true"
                                    class="btn btn-xs btn-primary">
                                    View Graph
                                </a>
                            {% elif job.status == "failed" %}
                                <span class="text-error text-xs"
                                    >{{ job.error_message[:50] if job.error_message else 'Error' }}</span
                                >
                            {% else %}
                                <span
                                    class="loading loading-spinner loading-xs"></span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <div class="text-base-content/60 py-8 text-center">
        <p>No combined datasets yet</p>
    </div>
{% endif %}
