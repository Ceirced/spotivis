<div class="card bg-base-100 shadow-sm">
    <div class="card-body">
        <h3 class="card-title">Uploaded Files</h3>
        <div class="group overflow-x-auto">
            <p class="text-base-content/70 not-group-has-[tbody:empty]:hidden">
                No files uploaded yet.
            </p>
            <table class="table-zebra table group-has-[tbody:empty]:hidden">
                <thead>
                    <tr>
                        <th>File Name</th>
                        <th>Size</th>
                        <th>Upload Time</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody
                    hx-boost="true"
                    hx-swap="show:window:top"
                    hx-target="#content">
                    {%- for file in files -%}
                        {% include 'first/partials/_file_row.html' %}
                    {%- endfor -%}
                </tbody>
            </table>
        </div>
    </div>
</div>
<!-- Single Rename Modal -->
<dialog
    id="rename-modal"
    class="modal">
    <div class="modal-box">
        <h3 class="text-lg font-bold">Rename File</h3>
        <form
            id="rename-form"
            class="mt-4"
            hx-swap="outerHTML">
            <div class="form-control">
                <label class="label">
                    <span class="label-text">New Name</span>
                </label>
                <input
                    type="text"
                    id="rename-input"
                    name="new_name"
                    class="input input-bordered w-full"
                    autofocus
                    required />
            </div>
            <div class="modal-action">
                <button
                    type="button"
                    class="btn"
                    onclick="document.getElementById('rename-modal').close()">
                    Cancel
                </button>
                <button
                    type="submit"
                    class="btn btn-primary">
                    Rename
                </button>
            </div>
        </form>
    </div>
    <form
        method="dialog"
        class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>
<script>
    function openRenameModal(fileId, currentName, url) {
        const modal = document.getElementById("rename-modal");
        const form = document.getElementById("rename-form");
        const input = document.getElementById("rename-input");

        // Set the current name in the input
        input.value = currentName;
        // Focus the input field

        // Update form HTMX attributes
        form.setAttribute("hx-put", url);
        form.setAttribute("hx-target", `#file-row-${fileId}`);

        // Initialize HTMX on the form if not already done
        htmx.process(form);

        // Close modal after successful request
        form.addEventListener("htmx:afterRequest", function closeModal(event) {
            if (event.detail.successful) {
                modal.close();
                form.removeEventListener("htmx:afterRequest", closeModal);
            }
        });

        // Show the modal
        modal.showModal();
        input.focus();
    }
</script>
