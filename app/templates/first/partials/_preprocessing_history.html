{% macro content() %}
    <div class="flex flex-1 flex-col">
        <div class="breadcrumbs mb-4 text-sm">
            <ul>
                <li>
                    <a
                        href="{{ url_for('first.index') }}"
                        hx-boost="true"
                        hx-target="#content"
                        hx-swap="show:window:top">
                        Files
                    </a>
                </li>
                <li>
                    <a
                        href="{{ url_for('first.preview_file', uuid=jobs[0].uploaded_file.uuid) }}"
                        hx-boost="true"
                        hx-target="#content"
                        hx-swap="show:window:top">
                        {{ jobs[0].uploaded_file.name }}
                    </a>
                </li>
                <li>{{ title }}</li>
            </ul>
        </div>
        <div class="overflow-x-auto">
            <h3 class="mb-4 text-lg font-semibold">{{ title }}</h3>
            {% if jobs %}
                <table class="table-zebra table">
                    <thead>
                        <tr>
                            {% if not hide_file_column %}
                                <th>File</th>
                            {% endif %}
                            <th>Status</th>
                            <th>Started</th>
                            <th>Completed</th>
                            <th>Nodes</th>
                            <th>Edges</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for job in jobs %}
                            <tr>
                                {% if not hide_file_column %}
                                    <td>{{ job.uploaded_file.name }}</td>
                                {% endif %}
                                <td>
                                    <span
                                        class="badge {% if job.status == 'completed' %}badge-success{% elif job.status in ['failed', 'cancelled'] %}badge-error{% else %}badge-warning{% endif %} badge-soft">
                                        {{ job.status }}
                                    </span>
                                </td>
                                <td>
                                    {{ job.started_at.strftime('%Y-%m-%d %H:%M') }}
                                </td>
                                <td>
                                    {% if job.completed_at %}
                                        {{ job.completed_at.strftime('%Y-%m-%d %H:%M') }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>
                                    {% if job.final_nodes %}
                                        {{ job.final_nodes }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>
                                    {% if job.final_edges %}
                                        {{ job.final_edges }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>
                                    {% if job.status == 'failed' and job.error_message %}
                                        <span
                                            class="text-error text-sm"
                                            title="{{ job.error_message }}"
                                            >Error</span
                                        >
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="text-gray-500">No preprocessing jobs found.</p>
            {% endif %}
        </div>
    </div>
{% endmacro %}

{% if htmx.boosted %}
    <title>{{ title }}</title>

    {% include 'partials/_back_top_bar.html' %}
    {{ content() }}
{% else %}
    {% extends 'base.html' %}
    {% block content %}
        {{ content() }}
    {% endblock %}
{% endif %}
