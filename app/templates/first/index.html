{% macro content() %}
    <h1 class="mb-8 text-3xl font-bold">Spotify Data Visualizer</h1>

    <div class="card bg-base-200 shadow-sm">
        <div class="card-body">
            <h2 class="card-title">Upload Your Spotify Data</h2>
            <p class="mb-4">
                Upload your Spotify data export in Parquet format to visualize
                your listening habits.
            </p>

            <form
                id="upload-form"
                hx-post="{{ url_for('first.upload_file') }}"
                hx-encoding="multipart/form-data"
                hx-trigger="submit"
                hx-indicator="#upload-progress"
                hx-target="#upload-result">
                <fieldset class="fieldset">
                    <legend class="fieldset-legend">Pick a Parquet file</legend>
                    <input
                        type="file"
                        name="file"
                        accept=".parquet"
                        class="file-input file-input-primary w-full max-w-sm"
                        required />
                    <label class="label"
                        >Max size {{ max_file_size_mb }}MB</label
                    >
                </fieldset>

                <div class="mt-4">
                    <button
                        type="submit"
                        class="btn btn-primary shadow">
                        Upload File
                        <span
                            id="upload-progress"
                            class="htmx-indicator loading loading-spinner loading-sm ml-2"></span>
                    </button>
                </div>
            </form>

            <div
                id="upload-result"
                class="mt-4"></div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="mt-8">
        <div class="mb-6 flex gap-4">
            <a
                href="{{ url_for('first.combine_files') }}"
                hx-boost="true"
                hx-target="#content"
                hx-swap="show:window:top"
                class="btn btn-outline btn-primary">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="h-5 w-5">
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M2.25 18.75a60.07 60.07 0 0 1 15.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 0 1 3 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 0 0-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 0 1-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 0 0 3 15h-.75" />
                </svg>
                Combine Datasets
            </a>
        </div>
    </div>

    <div
        id="file-list"
        class="mt-8"
        hx-get="/first/files"
        hx-trigger="load, refresh">
        <!-- File list will be loaded here -->
    </div>

    <div
        id="preprocessing-history"
        class="mt-8"
        hx-get="{{ url_for('first.preprocessing_history') }}"
        hx-trigger="load, refresh">
        <!-- Preprocessing history will be loaded here -->
    </div>

    {% if config['FLASK_ENV'] == 'production' %}
        <script>
            posthog.identify(
                "{{ current_user.id }}", // Replace 'distinct_id' with your user's unique identifier
                {
                    email: "{{current_user.email}}",
                    name: "{{current_user.username}}",
                } // optional: set additional user properties
            );
        </script>
    {% endif %}
{% endmacro %}

{% if htmx.boosted %}
    <title>{{ title }}</title>

    <div
        id="top-bar"
        hx-swap-oob="innerHTML">
        {% block top_bar %}
            <div class="flex w-full justify-end">
                <a
                    href="{{ url_for('users.settings') }}"
                    hx-boost="true"
                    hx-swap="show:window:top"
                    hx-target="#content">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        class="hover:stroke-primary size-7 stroke-current stroke-[1.5px] transition-colors duration-200 ease-out">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
                    </svg>
                </a>
            </div>
        {% endblock %}
    </div>
    {{ content() }}
{% else %}
    {% extends 'base.html' %}
    {% block content %}
        {{ content() }}
    {% endblock %}
{% endif %}
