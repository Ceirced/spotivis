{% macro content() %}
    <h1 class="mb-8 text-3xl font-bold">Spotify Data Visualizer</h1>

    <div class="card bg-base-200 shadow-sm">
        <div class="card-body">
            <h2 class="card-title">Upload Your Spotify Data</h2>
            <p class="mb-4">
                Upload your Spotify data export in Parquet format to visualize
                your listening habits.
            </p>

            <form
                id="upload-form"
                class="flex gap-4"
                hx-post="{{ url_for('first.upload_file') }}"
                hx-encoding="multipart/form-data"
                hx-trigger="change"
                hx-indicator="#upload-progress"
                hx-target="#upload-result">
                <fieldset class="fieldset">
                    <legend class="fieldset-legend">Pick a Parquet file</legend>
                    <div class="flex gap-4">
                        <input
                            type="file"
                            name="file"
                            accept=".parquet"
                            class="file-input file-input-primary w-full max-w-sm"
                            required />
                        <span
                            id="upload-progress"
                            class="htmx-indicator loading loading-spinner loading-sm ml-2"></span>
                    </div>
                    <label class="label"
                        >Max size {{ max_file_size_mb }}MB</label
                    >
                </fieldset>
            </form>

            <div
                id="upload-result"
                class="mt-4 empty:hidden"></div>
        </div>
    </div>

    <div
        id="file-list"
        class="mt-8"
        hx-get="/first/files"
        hx-trigger="load, refresh">
        <!-- File list will be loaded here -->
    </div>

    <div
        id="preprocessing-history"
        class="mt-8"
        hx-get="{{ url_for('first.preprocessing_history') }}"
        hx-trigger="load, refresh">
        <!-- Preprocessing history will be loaded here -->
    </div>

    {% if config['FLASK_ENV'] == 'production' %}
        <script>
            posthog.identify(
                "{{ current_user.id }}", // Replace 'distinct_id' with your user's unique identifier
                {
                    email: "{{current_user.email}}",
                    name: "{{current_user.username}}",
                } // optional: set additional user properties
            );
        </script>
    {% endif %}
{% endmacro %}

{% if htmx.boosted %}
    <title>{{ title }}</title>

    <div
        id="top-bar"
        hx-swap-oob="innerHTML">
        {% block top_bar %}
            <div class="flex w-full justify-end">
                <a
                    href="{{ url_for('users.settings') }}"
                    hx-boost="true"
                    hx-swap="show:window:top"
                    hx-target="#content">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        class="hover:stroke-primary size-7 stroke-current stroke-[1.5px] transition-colors duration-200 ease-out">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
                    </svg>
                </a>
            </div>
        {% endblock %}
    </div>
    {{ content() }}
{% else %}
    {% extends 'base.html' %}
    {% block content %}
        {{ content() }}
    {% endblock %}
{% endif %}
