{% set title = title|default(_fsdomain('Change Password')) %}
{% extends "security/base.html" %}
{% from "security/_macros.html" import render_field_with_errors, render_field, render_field_errors, render_form_errors %}

{% block content %}
    <form
        action="{{ url_for_security('change_password') }}"
        method="post"
        name="change_password_form">
        <fieldset
            class="fieldset bg-base-200 border-base-300 rounded-box mx-auto mt-10 w-xs gap-5 border p-8 sm:w-sm">
            <legend class="fieldset-legend">
                {{ _fsdomain('Change Password') }}
            </legend>

            {{ change_password_form.hidden_tag() }}
            {{ render_form_errors(change_password_form) }}

            {% if active_password %}
                <!-- old password -->
                <label class="floating-label input">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="size-5 opacity-50">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z" />
                    </svg>
                    <span>Password</span>
                    {{ change_password_form.password(placeholder='Current Password', autocomplete='current-password') }}
                </label>

                {% if change_password_form.password.errors %}
                    <ul>
                        {% for error in change_password_form.password.errors %}
                            <li class="text-error">{{ error }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% else %}
                <h3>
                    {{ _fsdomain('You do not currently have a password - this will add one.') }}
                </h3>
            {% endif %}

            <!-- New Password -->
            <label class="floating-label input">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-5 opacity-50">
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z" />
                </svg>
                <span>Password</span>
                {{ change_password_form.new_password(placeholder='New Password', autocomplete='new-password') }}
            </label>

            {% if change_password_form.new_password.errors %}
                <ul>
                    {% for error in change_password_form.new_password.errors %}
                        <li class="text-error">{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}

            <!-- Confirm New Password -->
            <label class="floating-label input">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-5 opacity-50">
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z" />
                </svg>
                <span>Password</span>
                {{ change_password_form.new_password_confirm(placeholder='Confirm Password', autocomplete='new-password') }}
            </label>

            {% if change_password_form.new_password_confirm.errors %}
                <ul>
                    {% for error in change_password_form.new_password_confirm.errors %}
                        <li class="text-error">{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}

            {% if change_password_form.csrf_token.errors %}
                {{ render_field_errors(change_password_form.csrf_token) }}
            {% endif %}
            {{ change_password_form.submit(class='btn btn-neutral shadow') }}
        </fieldset>
    </form>
{% endblock content %}
